<!doctype html><html lang="nl"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>MFS</title>
<link rel="manifest" href="./manifest.json"/><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>.glass-card{background:rgba(255,255,255,.65);backdrop-filter:saturate(180%) blur(10px)}.t{min-height:44px;min-width:44px}</style></head>
<body class="bg-slate-100 text-slate-900"><div class="max-w-6xl mx-auto p-4 pb-24">
<header class="mb-4 flex justify-between items-center gap-3"><h1 class="text-2xl font-bold">Mijn Films en Series</h1>
<div class="flex gap-2"><button id="ijson" class="t px-3 py-2 rounded-xl bg-white/70 shadow text-sm">Importeer JSON</button>
<button id="icsv" class="t px-3 py-2 rounded-xl bg-white/70 shadow text-sm">Importeer CSV (IMDb)</button>
<button id="demo" class="t px-3 py-2 rounded-xl bg-indigo-600 text-white shadow text-sm">Demo-items</button>
<button id="post" class="t px-3 py-2 rounded-xl bg-emerald-600 text-white shadow text-sm">Posters aanvullen</button></div></header>
<section class="mb-3"><div id="filters" class="flex flex-wrap gap-2"><button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="film">Films</button>
<button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="serie">Series</button><button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="herman-film">H-Films</button>
<button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="herman-serie">H-Series</button><button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="aan-het-kijken">Aan het kijken</button>
<button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="bekeken">Bekeken</button><button class="f px-3 py-1.5 rounded-lg bg-white/50" data-k="all">Alles</button>
<div class="flex-1"></div><input id="q" placeholder="Zoeken…" class="px-3 py-2 rounded-lg bg-white/70 shadow w-48"/></div></section>
<main><div id="list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div><p id="empty" class="hidden text-center text-slate-600 py-10">Laden…</p></main></div>
<script>
const DB='mfs-db',V=1,S='items',OMDB='8a70a767';
function openDB(){return new Promise((ok,err)=>{const r=indexedDB.open(DB,V);r.onupgradeneeded=()=>{const d=r.result; if(!d.objectStoreNames.contains(S)){const s=d.createObjectStore(S,{keyPath:'id'});s.createIndex('createdAt','createdAt');s.createIndex('type','type');}};r.onsuccess=()=>ok(r.result);r.onerror=()=>err(r.error);});}
function tx(db,m='readonly'){return db.transaction(S,m).objectStore(S)}
async function all(){const db=await openDB();return new Promise((ok,err)=>{const g=tx(db).getAll();g.onsuccess=()=>ok(g.result||[]);g.onerror=()=>err(g.error);});}
async function put(x){const db=await openDB();return new Promise((ok,err)=>{const p=tx(db,'readwrite').put(x);p.onsuccess=()=>ok();p.onerror=()=>err(p.error);});}
async function del(id){const db=await openDB();return new Promise((ok,err)=>{const d=tx(db,'readwrite').delete(id);d.onsuccess=()=>ok();d.onerror=()=>err(d.error);});}
async function bulk(xs){const db=await openDB();return new Promise((ok,err)=>{const s=tx(db,'readwrite');xs.forEach(i=>s.put(i));s.transaction.oncomplete=()=>ok();s.transaction.onerror=()=>err(s.transaction.error);});}
const app={state:{items:[],f:'all',q:''}};
app.init=async function(){this.L=document.getElementById('list');this.E=document.getElementById('empty');document.getElementById('filters').addEventListener('click',e=>{const b=e.target.closest('.f');if(!b)return;this.state.f=b.dataset.k;this.render();});document.getElementById('q').addEventListener('input',e=>{this.state.q=e.target.value.trim();this.render();});document.getElementById('ijson').addEventListener('click',()=>this.impJSON());document.getElementById('icsv').addEventListener('click',()=>this.impCSV());document.getElementById('demo').addEventListener('click',()=>this.demo());document.getElementById('post').addEventListener('click',()=>this.fill()); try{this.state.items=await all();}catch(e){console.error(e);} this.render();};
app.impJSON=async function(){const i=document.createElement('input');i.type='file';i.accept='application/json';i.onchange=async ()=>{const f=i.files[0];if(!f)return;let a=[];try{a=JSON.parse(await f.text());}catch{alert('Geen geldige JSON');return;}const t=Date.now();const n=a.map((r,k)=>({id:r.id||`${t}-${k}`,title:r.title||'Onbekend',type:r.type||'film',createdAt:r.createdAt||(t+k),imdbRating:r.imdbRating||'',year:r.year||'',runtime:r.runtime||'',poster:r.poster||'',streamingOn:r.streamingOn||'',ourScore:r.ourScore||'',dateSeen:r.dateSeen||'',imdbID:r.imdbID||r.imdbId||''}));await bulk(n);app.state.items=await all();app.render();};i.click();};
app.impCSV=async function(){const i=document.createElement('input');i.type='file';i.accept='.csv,text/csv';i.onchange=async ()=>{const f=i.files[0];if(!f)return;Papa.parse(f,{header:true,skipEmptyLines:true,transformHeader:h=>(h||'').toString().trim().toLowerCase(),complete:async (res)=>{const rows=res.data||[];const t=Date.now();const items=rows.map((r,k)=>{const L={};Object.keys(r).forEach(x=>L[(x||'').toString().trim().toLowerCase()]=r[x]);const g=k=>L[k]??'';const ic=(g('const')||'').toString().trim();const title=(g('title')||g('original title')||'').toString().trim()||'Onbekend';const year=(g('year')||'').toString().trim();const rt=(g('runtime (min)')||g('runtime')||'').toString().trim();const ir=(g('imdb rating')||g('imdb_rating')||'').toString().trim();const ur=(g('your rating')||g('your_rating')||'').toString().trim();const dr=(g('date rated')||g('date_rated')||'').toString().trim();const pf=(g('description')||g('where')||'').toString().trim();return {id:`${t}-${k}`,title,type:'aan-het-kijken',createdAt:t+k,imdbRating:ir,year, runtime:rt?(/(min|seizoen|aflever)/i.test(rt)?rt:`${rt} min`):'', poster:'', streamingOn:pf, ourScore:ur, dateSeen:dr, imdbID:ic};});await bulk(items);app.state.items=await all();app.render();alert(`CSV geïmporteerd: ${items.length} items`);}});};i.click();};
app.demo=async function(){const t=Date.now();await bulk([{id:`d-${t}`,title:'Inception',type:'film',createdAt:t,imdbRating:'8.8',year:'2010',runtime:'148 min',poster:'',streamingOn:'Netflix',ourScore:'9/10',imdbID:'tt1375666'}]);this.state.items=await all();this.render();}
app.fill=async function(){const key=OMDB;const items=await all();let upd=0;for(const it of items){if(it.poster&&it.poster!=='N/A')continue;try{let u=`https://www.omdbapi.com/?apikey=${encodeURIComponent(key)}&plot=short&r=json`;if(it.imdbID)u+=`&i=${encodeURIComponent(it.imdbID)}`;else u+=`&t=${encodeURIComponent(it.title)}${it.year?`&y=${encodeURIComponent(it.year)}`:''}`;const r=await fetch(u);const d=await r.json();if(d&&d.Response!=='False'){if(!it.imdbID&&d.imdbID)it.imdbID=d.imdbID;if(d.Poster&&d.Poster!=='N/A'){it.poster=d.Poster;await put(it);upd++;}}await new Promise(r=>setTimeout(r,250));}catch(e){console.warn('OMDb',e);}} this.state.items=await all();this.render();alert('Posters aangevuld: '+upd);} ;
app.filtered=function(){let a=this.state.items.slice();const t=this.state.q.toLowerCase();if(this.state.f!=='all')a=a.filter(i=>i.type===this.state.f);if(t)a=a.filter(i=>(i.title||'').toLowerCase().includes(t));a.sort((x,y)=>(y.createdAt||0)-(x.createdAt||0));return a;}
app.render=function(){const L=document.getElementById('list'),E=document.getElementById('empty');L.innerHTML='';const items=this.filtered();if(!items.length){E.textContent='Geen items in deze filter.';E.classList.remove('hidden');return;}E.classList.add('hidden');items.forEach((it,idx)=>L.appendChild(this.card(it,idx+1)));}
app.card=function(it,idx){const tag={film:['bg-sky-200/80 text-sky-900','Film'],serie:['bg-amber-200/80 text-amber-900','Serie'],'herman-film':['bg-purple-200/80 text-purple-900','H-Film'],'herman-serie':['bg-pink-200/80 text-pink-900','H-Serie'],'aan-het-kijken':['bg-blue-200/80 text-blue-900','Aan het kijken'],bekeken:['bg-green-200/80 text-green-900','Bekeken']};const t=tag[it.type]||['bg-slate-200/80 text-slate-900',it.type];const poster=(it.poster&&it.poster!=='N/A')?it.poster:'https://placehold.co/400x600/e2e8f0/94a3b8?text=Geen+poster';const sopts=['','Netflix','Disney+','Prime Video','Apple TV+','VRT MAX','Play','Streamz','Videoland','Blu-ray','iTunes'].map(o=>`<option value="${o}" ${it.streamingOn===o?'selected':''}>${o}</option>`).join('');const copts=Object.keys(tag).map(k=>`<option value="${k}" ${it.type===k?'selected':''}>${tag[k][1]}</option>`).join('');let date='';if(it.type==='bekeken'){date=`<div class='mt-2'><label class='block text-xs font-medium text-slate-600 mb-0.5'>Laatst gezien op</label><input type='date' data-id='${it.id}' value='${it.dateSeen||''}' class='date-seen-input w-full p-1.5 border border-slate-300/50 rounded-md'></div>`;}return (function(){const d=document.createElement('div');d.className='glass-card rounded-xl overflow-hidden shadow-lg text-slate-800';d.innerHTML=`<div class='flex'><div class='w-1/2 relative'><div class='aspect-[2/3] w-full'><img src='${poster}' class='w-full h-full object-cover' alt=''></div><div class='absolute top-2 left-2 bg-black/70 text-white w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm'>${idx}</div></div><div class='p-3 flex flex-col flex-grow w-1/2'><h3 class='font-bold text-base leading-tight mb-2'>${it.title}</h3><div class='text-sm text-slate-700 space-y-0.5 mb-2'><p><strong>IMDB:</strong> ${it.imdbRating||'N/B'}</p><p><strong>Jaar:</strong> ${it.year||'N/B'}</p><p><strong>Duur:</strong> ${it.runtime||'N/B'}</p></div><div class='mb-2 flex justify-between items-center'><span class='text-xs font-semibold px-2 py-0.5 rounded-full ${t[0]}'>${t[1]}</span><button data-id='${it.id}' data-action='delete' class='t bg-white/50 text-slate-600 hover:bg-red-500 hover:text-white w-7 h-7 flex items-center justify-center rounded-full transition-all'><svg class='h-4 w-4' xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><path stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12'/></svg></button></div><div class='flex flex-col gap-2 mt-1'><input type='text' data-id='${it.id}' value='${it.ourScore||''}' class='our-score-input w-full p-1.5 border border-slate-300/50 rounded-md text-xs' placeholder='Onze score'><button data-id='${it.id}' data-imdbid='${it.imdbID||''}' data-action='show-imdb' class='w-full bg-yellow-400/80 text-yellow-900 hover:bg-yellow-400 font-semibold py-1.5 px-2 rounded-md text-xs'>IMDB Info</button></div></div></div><div class='p-3 pt-2 text-xs space-y-2 border-t border-white/20'><div class='grid grid-cols-2 gap-2'><div><label class='block font-medium text-slate-600 mb-0.5'>Categorie</label><select data-id='${it.id}' class='category-select w-full p-1.5 border border-slate-300/50 rounded-md'>${copts}</select></div><div><label class='block font-medium text-slate-600 mb-0.5'>Waar te bekijken</label><select data-id='${it.id}' class='streaming-service-select w-full p-1.5 border border-slate-300/50 rounded-md'>${sopts}</select></div></div>${date}</div>`;return d;})()}
document.addEventListener('click',async e=>{const d=e.target.closest('[data-action="delete"]');if(d){await del(d.dataset.id);app.state.items=await all();app.render();}const imdb=e.target.closest('[data-action="show-imdb"]');if(imdb){const id=imdb.dataset.imdbid;if(id)window.open('https://www.imdb.com/title/'+id,'_blank');}});
document.addEventListener('change',async e=>{const id=e.target.getAttribute('data-id');if(!id)return;const it=app.state.items.find(x=>x.id==id);if(!it)return;if(e.target.classList.contains('category-select'))it.type=e.target.value;if(e.target.classList.contains('streaming-service-select'))it.streamingOn=e.target.value;if(e.target.classList.contains('our-score-input'))it.ourScore=e.target.value;if(e.target.classList.contains('date-seen-input'))it.dateSeen=e.target.value;await put(it);app.render();});
document.addEventListener('DOMContentLoaded',()=>app.init());
</script></body></html>