<!doctype html>
<html lang="nl" class="h-full bg-slate-100">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#0f172a"/>
<link rel="manifest" href="./manifest.json"/>
<link rel="apple-touch-icon" href="./icons/icon-192.png"/>
<title>Mijn Films en Series (noSW debug)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>.glass-card{background:rgba(255,255,255,.65);backdrop-filter:saturate(180%) blur(10px)}</style>
</head>
<body class="h-full text-slate-900">
<div id="app" class="max-w-6xl mx-auto p-4 pb-24">
  <header class="mb-4 flex items-center justify-between gap-3">
    <h1 class="text-2xl font-bold">Mijn Films en Series</h1>
    <div class="flex gap-2 items-center">
      <button id="btn-add-demo" class="px-3 py-2 rounded-xl bg-indigo-600 text-white shadow text-sm">Demo-items</button>
    </div>
  </header>
  <main>
    <div id="list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
    <p id="emptyState" class="text-center text-slate-600 py-10">App initâ€¦</p>
  </main>
</div>
<script>
const DB_NAME='mfs-db', DB_VERSION=1, STORE='items';
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB_NAME,DB_VERSION);r.onupgradeneeded=()=>{const db=r.result;if(!db.objectStoreNames.contains(STORE))db.createObjectStore(STORE,{keyPath:'id'});};r.onsuccess=()=>res(r.result);r.onerror=()=>rej(r.error);});}
function tx(db,mode='readonly'){return db.transaction(STORE,mode).objectStore(STORE);}
async function dbGetAll(){const db=await openDB();return new Promise((res,rej)=>{const g=tx(db).getAll();g.onsuccess=()=>res(g.result||[]);g.onerror=()=>rej(g.error);});}
async function dbBulkPut(items){const db=await openDB();return new Promise((res,rej)=>{const s=tx(db,'readwrite');items.forEach(i=>s.put(i));s.transaction.oncomplete=()=>res();s.transaction.onerror=()=>rej(s.transaction.error);});}

const app={state:{items:[]}};
app.init=async function(){
  console.log('init start');
  try{this.state.items=await dbGetAll();}catch(e){console.error('db error',e);}
  this.render();
  console.log('init done');
};
app.render=function(){
  const list=document.getElementById('list'), empty=document.getElementById('emptyState');
  list.innerHTML='';
  if(!this.state.items.length){ empty.textContent='Geen data. Klik Demo-items.'; return; }
  empty.textContent='';
  this.state.items.forEach((it,idx)=>{
    const d=document.createElement('div'); d.className='glass-card p-4 rounded-xl'; d.textContent=it.title||'item'; list.appendChild(d);
  });
};
document.getElementById('btn-add-demo').addEventListener('click', async ()=>{
  const now=Date.now();
  await dbBulkPut([{id:`d-${now}`,title:'Testkaart'}]);
  app.state.items=await dbGetAll(); app.render();
});
document.addEventListener('DOMContentLoaded',()=>app.init());
</script>
</body>
</html>
